---
layout: default
title: Server Side Technologies - Task 2
---

<h1>Server Side Technologies</h1>

<h2>Task 2 - Introduction to PostgreSQL and DbVisualizer</h2>

<ol>
	<p>We have created a PostgreSQL database instance named ‘geog5871’ on the dialogplus.leeds.ac.uk remote server. 
	In this task you will:</p>

	<ul>
		<li>Create a connection to the geog5871 database instance</li>
		<li>Interrogate the existing ‘tweets’ tables using SQL</li>
		<li>Create your own table using additional data-sets</li> 
	</ul>

	<!--<h3>1.0 Setting up the connection off campus</h3>

	<strong>This step is only required if you are connecting to dialogplus off campus. 
	Ensure you are connected to the VPN </strong>

	<p>PostgreSQL does support SSL (Secure Socket Layer) connections, however it is not advisable to allow access 
	from all public IP addresses, for this reason, you are going to establish a connection to the database host via 
	an SSH (Secure SHell) tunnel. To connect to the dialogplus.leeds.ac.uk server from outside the Leeds network, a 
	SSH tunnel must be established between the remote server and the local host. </p>

	<ol>
		<li>Open Putty and enter the following credentials in the ‘session’ window:<br />
			<br />Host Name: 	dialogplus.leeds.ac.uk
			<br />Port: 		22
			<br />Username:		Your allocated username e.g. web01</li>
		<br />
		<li>Now expand the ‘SSH’ menu item in the left hand panel and select ‘Tunnels’. </li>
		<br />
		<li>In the tunnels window set the source port to 5433 (note: we are not using the default local host port 
			5432 as we may want to use this for a local PostgreSQL connection later). </li>
		<br />
		<li>Set the destination IP address to 127.0.0.1:5432. </li>
		<br />
		<li>Add this connection using the ‘Add’ button and click ‘Open’ to establish the connection. </li>
		<br />
		<li>Leaving the Putty connection open, follow the instructions below to connect to the database instance 
		using pgAdmin (use 5433 as the localhost port instead of 5432).</li>
	</ol> -->

	<h3>1.0 Interfacing with PostgreSQL using DbVisualizer</h3>

	<p>If you are using a computer on the University of Leeds network you can connect directly to the PostgreSQL 
	database instance on the dialogplus.leeds.ac.uk server through DbVisualizer.  
	DbVisualizer is a free administration and development platform for PostgreSQL, unfortunately it isn't installed on the 
	University machines, so you need to download a copy now and run it from your M drive.</p>

	<li>Download DbVisualizer <a href = 'http://www.dbvis.com/download'>here</a>(32-bit setup installer) and run the EXE file. 
	If you are using a University owned machine, ensure that the install directory is set to your M:/drive. </li><br />
	
	<li>Connect to the dialogplus.leeds.ac.uk server by clicking the ‘Create new database connection’ button on the 
	top left hand side of the toolbar, under the 'Databases' tab. </li><br />
	
	<li>Use the database connection wizard to create a new connection to the dialogplus.leeds.ac.uk server.
	Enter a suitable connection alias that allows you to recognise the connection and enter the following 
	credentials including the <strong>database username and password</strong>:<br />
	
		</p> Database Driver: 	PostgreSQL
		<br />Database Server: 	dialogplus.leeds.ac.uk
		<br />Database Port:	5432
		<br />Database:			geog5871
		<br />Userid:			XXX
		<br />Password:			XXX</p>
	
	<img src = 'addServer.PNG' width = '600px' alt = 'Add Database Connection Wizard'>
	
	<p>DbVisualizer has extensive functionality which makes it easy to query, edit and display data. 
	You will see an object browser on the left hand side of the window, showing the various database 
	connections (you should see the alias name you provided here)</p> 

	<li>Expand the geog5871 database and view the different subdirectories enclosed within. </li><br />
	
	<li>Find the ‘tweets’ table located in public > TABLE and explore the data, by right clicking and selecting
	'open in new tab'. You should see a number of tabs appear at the top of the page, including: data, columns, info etc.
	How many columns are there? How many rows are there? Which column is the primary key?</li>

	<h3>3.0 Querying the Data </h3>

	<li>Click on the green arrow icon on the top toolbar to open a new 'SQL Commander'. 
		
	This query builder allows you to query the data using Structured Query Language (SQL). 
	There is also the option to use pgSQL; spatially enabled structured query language. 
	Although this database is a PostgreSQL database, the data within it is not spatially enabled. </li><br />
	
		<img src = 'sqlCommander.PNG' alt = 'SQL Commander'><br /><br />
	
	<li>Use the <a href = 'http://www.w3schools.com/sql/sql_where.asp'>w3 schools</a> web pages to work out how to build 
	an SQL query to select all messages that were tweeted on day 30 of the sample we have collected.
	To run the query select the green arrow icon. The result will be displayed in the results window beneath.</li><br />
	
	<li>Build a further 2 queries of your choice and made a note of the syntax you used, as you may want to use this later.  
	You can also save the query text if you wish. (File > Save As)</li><br />
	
	<li>It is suggested that you use DbVisualizer throughout the remainder of the course to check that your SQL syntax 
	is correct and that data have been imported correctly etc. </li>
	
	<h3>4.0 Creating a Table</h3>
	<li>Unfortunately this version of DbVisualiser does not support table creation, so we are going to go back to the 
	command line in order to create a new table within the database. Open Putty now and log in using your dialogplus 
	login credentials.</li><br />
	
	<li>Use the command below to access the psql command line and connect to the geog5871 database, you will then be prompted
	for the database password.<br />
	<code>psql –U <EM>postgresUserName</EM> geog5871</code></li><br />
	
	<li>If the database connection has been established successfully, the command line prompt will change to:
	<code>geog5871=></code></li><br />
	
	<li>In a browser, visit the spreadsheet page on the <a href = 'http://earthquake.usgs.gov/earthquakes/feed/v1.0/csv.php'>
	USGS webpage</a> and download data in CSV format for all earthquakes which have occurred in the past month. 
	Open this file in excel to view the data. Tidy up the spreadsheet so that only; ‘time’, ‘latitude’, ‘longitude’, 
	‘depth’, ‘magnitude’,‘id’ and ‘place’ remain. </li><br />
	 
	<li> Now that we know the format of the data, we can create a table to store it. Using the syntax below (where &lttable name&gt is 
	an appropriate name you have chosen for your database), create a new table. 
	
	As all of your tables will be created in the same location, we recommend that you include your username 
	somewhere in the title so you can identify your table once it has been created. Note: if the below doesn't work, try it all on one line. <br /><br />
	
	<code>CREATE TABLE <EM>tableName</EM>
	<br />(
	<br />"time" character varying(140),
	<br />latitude numeric(150,2),
	<br />longitude numeric(150,2),
	<br />depth numeric(150,2),
	<br />magnitude numeric(150,2),
	<br />id character varying(150),
	<br />place character varying(150)
	<br />)
	<br />WITH (OIDS=FALSE);
	</code></li><br />
	
	<li>You may also have to set permissions for your table using the following code with your &ltusername&gt and &lttable name&gt:<br />
	<code>

	<br />ALTER TABLE <EM>tableName</EM>
	<br />OWNER TO <EM>postgresUserName</EM>;
	<br />GRANT ALL ON TABLE <EM>tableName</EM> TO <EM>postgresUserName</EM>
	<br />GRANT SELECT, UPDATE, INSERT ON TABLE <EM>tableName</EM> TO <EM>postgresUserName</EM></code></li><br />

	
	<li>Go back to the Earthquakes excel spreadsheet and remove the first line which contains the header information 
	(this contains character data which is not compatible with the numeric field definitions you have just created). 
	Save the spreadsheet as a CSV file and upload it to your working directory (<CODE>/home/<EM>serverUserName</EM>/</CODE>) on dialogplus using WinSCP; a File
	Transfer Protocol software used to transfer files from your local directory to the server (File protocol
	: SFTP, Host name: dialogplus.leeds.ac.uk, Port number: 22). </li><br />
	
	<li>Now the data is in the same location as the database, you should now be able to import the CSV data into the 
	newly created table using the following code in the psql command line:<br />
	<code>
	\COPY &lttable name&gt FROM '/var/www/html/geog5870/<EM>serverUserName</EM>/<EM>filename</EM>.csv' WITH DELIMITER ',' CSV</code></li><br />
	
	<li>View the newly created table and data in DbVisualizer to ensure it has imported correctly (you may have to refesh).</li> <br />
	<li>Repeat the above steps to create a copy of the tweets table using this <a href = 'tweets.csv'>CSV file</a>.</li>
</ol>
<hr class="post_float">[ Next: <a href="../4_php/index.html">PHP: Hypertext Preprocessor</a> ]<br>
</body></html>
